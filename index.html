<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="theme-color" content="#000000" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Nino - AI Hotel Marketing" />
    <title>Nino - AI Hotel Marketing Photos</title>
    <meta name="description" content="AI-powered luxury hotel marketing photo generation platform" />
    <meta name="author" content="Nino" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="preload" href="/src/main.tsx" as="script">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/favicon.svg">
    <link rel="shortcut icon" href="/favicon.ico">

    <meta property="og:title" content="Nino - AI Hotel Marketing Photos" />
    <meta property="og:description" content="Create stunning luxury hotel marketing photos with AI" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@lovable_dev" />
    <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
  </head>

  <body>
    <style>
      /* Prevent white flash on load */
      html, body {
        background-color: hsl(0 0% 100%);
        margin: 0;
        padding: 0;
      }
      
      #root {
        background-color: hsl(0 0% 100%);
        min-height: 100vh;
        opacity: 1;
        transition: opacity 0s;
      }
      
      /* Loading spinner */
      .loading-spinner {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 24px;
        height: 24px;
        border: 2px solid hsl(0 0% 91%);
        border-top: 2px solid hsl(0 0% 3%);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        z-index: 9999;
      }
      
      @keyframes spin {
        0% { transform: translate(-50%, -50%) rotate(0deg); }
        100% { transform: translate(-50%, -50%) rotate(360deg); }
      }
      
      /* Hide spinner once React loads */
      #root:not(:empty) + .loading-spinner {
        display: none;
      }
    </style>
    
    <div id="root"></div>
    <div class="loading-spinner"></div>
    
    <script>
      // AGGRESSIVE tab preservation and state management
      let isTabActive = true;
      let keepAliveInterval;
      let lastActiveTime = Date.now();
      
      // Enhanced Page Visibility API
      document.addEventListener('visibilitychange', function() {
        isTabActive = !document.hidden;
        
        if (isTabActive) {
          console.log('🔄 Tab became active - preserving state');
          lastActiveTime = Date.now();
          
          // Resume keep-alive when tab becomes active
          if (keepAliveInterval) clearInterval(keepAliveInterval);
          startKeepAlive();
          
          // Force save current state
          try {
            if (window.React && window.React.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED) {
              // Trigger React to save state
              console.log('💾 Triggering React state save');
            }
          } catch (e) {
            // Ignore React internals access
          }
        } else {
          console.log('💤 Tab became inactive - aggressive state preservation');
          
          // Save timestamp
          localStorage.setItem('nino-last-active', Date.now().toString());
          
          // Save current URL
          localStorage.setItem('nino-current-url', window.location.href);
        }
      });
      
      // Multiple beforeunload prevention strategies
      window.addEventListener('beforeunload', function(e) {
        // Always try to prevent unload for tab switches
        if (document.hidden) {
          e.preventDefault();
          e.returnValue = 'Stay on page to preserve your work';
          return 'Stay on page to preserve your work';
        }
      });
      
      // Prevent pagehide
      window.addEventListener('pagehide', function(e) {
        e.preventDefault();
        console.log('🚫 Preventing pagehide');
      });
      
      // Enhanced keep-alive mechanism
      function startKeepAlive() {
        keepAliveInterval = setInterval(() => {
          if (!document.hidden) {
            // Multiple keep-alive signals
            localStorage.setItem('nino-tab-keepalive', Date.now().toString());
            sessionStorage.setItem('nino-session-active', Date.now().toString());
            
            // Tiny DOM manipulation to keep renderer active
            document.title = document.title + ' '; // Add space
            setTimeout(() => {
              document.title = document.title.trim(); // Remove space
            }, 100);
            
            // Keep memory active with tiny allocation
            if (window.ninoKeepAlive) {
              window.ninoKeepAlive.push(Date.now());
              if (window.ninoKeepAlive.length > 10) {
                window.ninoKeepAlive = window.ninoKeepAlive.slice(-5);
              }
            } else {
              window.ninoKeepAlive = [Date.now()];
            }
          }
        }, 15000); // Every 15 seconds (more frequent)
      }
      
      // Start keep-alive immediately
      startKeepAlive();
      
      // Detect and recover from unwanted reloads
      window.addEventListener('load', function() {
        const lastActive = localStorage.getItem('nino-last-active');
        const currentTime = Date.now();
        
        if (lastActive && (currentTime - parseInt(lastActive)) < 60000) {
          console.log('⚠️ Detected potential unwanted reload within 1 minute');
          
          // Try to restore URL if different
          const savedUrl = localStorage.getItem('nino-current-url');
          if (savedUrl && savedUrl !== window.location.href) {
            console.log('🔄 Restoring previous URL:', savedUrl);
            window.history.replaceState(null, '', savedUrl);
          }
        }
      });
      
      // Prevent right-click refresh in dev (optional)
      document.addEventListener('contextmenu', function(e) {
        if (e.ctrlKey || e.metaKey) {
          // Allow dev tools, but warn about refresh
          console.log('🔄 Dev tools detected - be careful with refresh');
        }
      });
      
      console.log('🛡️ Aggressive tab preservation initialized');
    </script>
    
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
